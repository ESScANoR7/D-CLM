<div class="game-calc-container">
    <header class="view-header compact-header">
        <h1>‚öîÔ∏è –í—ñ–π—Å—å–∫–æ–≤–∏–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
    </header>

    <div class="tabs-wrapper">
        <button class="tab-btn active" onclick="switchCalcTab('train', this)">üõ°Ô∏è –¢1-–¢4</button>
        <button class="tab-btn" onclick="switchCalcTab('t5', this)">üåï –¢5 (–¶–µ—Ö)</button>
        <button class="tab-btn" onclick="switchCalcTab('speed', this)">‚ö° –°—É–º–∫–∞</button>
        <button class="tab-btn" onclick="switchCalcTab('old', this)">üîÑ –ö–æ–Ω–≤–µ—Ä—Ç</button>
    </div>

    <div id="calc-train" class="calc-content" style="display: block;">
        <div class="game-panel">
            <h3 class="panel-head">–ö–∞–∑–∞—Ä–º–∞ (–¢1-–¢4)</h3>
            <div class="grid-inputs">
                <div class="input-wrap">
                    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</label>
                    <input type="number" id="train-amount" class="arena-input" placeholder="0">
                </div>
                <div class="input-wrap">
                    <label>–®–≤–∏–¥–∫—ñ—Å—Ç—å %</label>
                    <input type="number" id="train-speed" class="arena-input" placeholder="350">
                </div>
            </div>
            <div class="control-section">
                <label>–†—ñ–≤–µ–Ω—å</label>
                <div class="tier-grid" id="tier-group-train">
                    <button class="tier-select" data-time="15" onclick="selectTier(this, 'train')">T1</button>
                    <button class="tier-select" data-time="30" onclick="selectTier(this, 'train')">T2</button>
                    <button class="tier-select" data-time="60" onclick="selectTier(this, 'train')">T3</button>
                    <button class="tier-select active" data-time="120" onclick="selectTier(this, 'train')">T4</button>
                </div>
            </div>
            <div class="result-bar">
                <span class="res-label">–ß–∞—Å:</span>
                <span id="train-result" class="res-value">0–¥ 0–≥ 0—Ö–≤</span>
            </div>
            <div class="actions-group">
                <button class="main-action-btn" onclick="calculateTraining()">–†–û–ó–†–ê–•–£–í–ê–¢–ò</button>
                <button class="reset-icon-btn" onclick="resetCalc('train')">üóëÔ∏è</button>
            </div>
        </div>
    </div>

    <div id="calc-t5" class="calc-content" style="display: none;">
        <div class="game-panel t5-panel">
            <h3 class="panel-head blue-head">–ú—ñ—Å—è—á–Ω–∏–π –¶–µ—Ö (Craft T5)</h3>
            
            <div class="t5-mode-switch">
                <button class="mode-btn active" onclick="toggleT5SubMode('speed', this)">‚è≥ –ó–∞ –ø—Ä–∏—Å–∫–æ—Ä–∏</button>
                <button class="mode-btn" onclick="toggleT5SubMode('gems', this)">üíé –ó–∞ –°–∞–ø—Ñ—ñ—Ä–∏</button>
            </div>

            <div class="grid-inputs">
                <div class="input-wrap">
                    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¢5</label>
                    <input type="number" id="t5-amount" class="arena-input blue-focus" placeholder="0">
                </div>
                <div class="input-wrap">
                    <label>–®–≤–∏–¥–∫—ñ—Å—Ç—å %</label>
                    <input type="number" id="t5-speed" class="arena-input blue-focus" placeholder="104">
                </div>
            </div>

            <div id="t5-sub-speed" class="t5-sub-content">
                <div class="result-bar blue-border">
                    <span class="res-label">–ü–æ—Ç—Ä—ñ–±–Ω–æ —á–∞—Å—É:</span>
                    <span id="t5-time-result" class="res-value blue-val">0–¥ 0–≥ 0—Ö–≤</span>
                </div>
                
                <div class="rss-table" id="t5-rss-block" style="display:none;">
                    <div class="rss-row lunite"><span>üåï –õ—É–Ω—ñ—Ç</span> <b id="t5-lunite">0</b></div>
                    <div class="rss-row"><span>üåæ –á–∂–∞</span> <b id="t5-food">0</b></div>
                    <div class="rss-row"><span>ü™® –ö–∞–º—ñ–Ω—å</span> <b id="t5-stone">0</b></div>
                    <div class="rss-row"><span>ü™µ –î–µ—Ä–µ–≤–æ</span> <b id="t5-wood">0</b></div>
                    <div class="rss-row"><span>üíé –†—É–¥–∞</span> <b id="t5-ore">0</b></div>
                    <div class="rss-row gold"><span>üí∞ –ó–æ–ª–æ—Ç–æ</span> <b id="t5-gold">0</b></div>
                </div>
                
                <div class="actions-group">
                    <button class="main-action-btn blue-btn" onclick="calculateT5Rss()">–†–û–ó–†–ê–•–£–í–ê–¢–ò</button>
                    <button class="reset-icon-btn" onclick="resetCalc('t5')">üóëÔ∏è</button>
                </div>
            </div>

            <div id="t5-sub-gems" class="t5-sub-content" style="display: none;">
                <div class="checkbox-container">
                    <label class="custom-checkbox">
                        <input type="checkbox" id="t5-has-lunite" onchange="calculateT5Gems()">
                        <span class="checkmark"></span>
                        –£ –º–µ–Ω–µ –≤–∂–µ —î –õ—É–Ω—ñ—Ç (–ø–ª–∞—á—É –ª–∏—à–µ –∑–∞ —á–∞—Å)
                    </label>
                </div>

                <div class="result-bar gem-bar">
                    <span class="res-label">–¶—ñ–Ω–∞:</span>
                    <span id="t5-gem-result" class="res-value gem-text">0 üíé</span>
                </div>

                <div class="gem-details" id="t5-gem-details" style="display:none;">
                    <div class="detail-row"><span>‚è≥ –ó–∞ —á–∞—Å:</span> <b id="gem-time-cost">0</b></div>
                    <div class="detail-row"><span>üåï –ó–∞ –õ—É–Ω—ñ—Ç:</span> <b id="gem-lunite-cost">0</b></div>
                </div>

                <div class="actions-group">
                    <button class="main-action-btn gem-btn" onclick="calculateT5Gems()">–†–û–ó–†–ê–•–£–í–ê–¢–ò (–°–ê–ü–§–Ü–†–ò)</button>
                    <button class="reset-icon-btn" onclick="resetCalc('t5')">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <div id="calc-speed" class="calc-content" style="display: none;">
        <div class="game-panel">
            <h3 class="panel-head">–í–º—ñ—Å—Ç –°—É–º–∫–∏</h3>
            <div class="result-bar sticky">
                <span class="res-label">–†–∞–∑–æ–º:</span>
                <span id="total-speed-time" class="res-value">0–¥ 0–≥ 0—Ö–≤</span>
            </div>
            <div class="bag-grid" id="speedup-inputs">
                <div class="bag-item"><span>1 —Ö–≤</span><input type="number" data-mins="1" class="bag-input"></div>
                <div class="bag-item"><span>5 —Ö–≤</span><input type="number" data-mins="5" class="bag-input"></div>
                <div class="bag-item"><span>10 —Ö–≤</span><input type="number" data-mins="10" class="bag-input"></div>
                <div class="bag-item"><span>15 —Ö–≤</span><input type="number" data-mins="15" class="bag-input"></div>
                <div class="bag-item"><span>30 —Ö–≤</span><input type="number" data-mins="30" class="bag-input"></div>
                <div class="bag-item"><span>60 —Ö–≤</span><input type="number" data-mins="60" class="bag-input"></div>
                <div class="bag-item blue"><span>3 –≥–æ–¥</span><input type="number" data-mins="180" class="bag-input"></div>
                <div class="bag-item blue"><span>8 –≥–æ–¥</span><input type="number" data-mins="480" class="bag-input"></div>
                <div class="bag-item blue"><span>15 –≥–æ–¥</span><input type="number" data-mins="900" class="bag-input"></div>
                <div class="bag-item blue"><span>24 –≥–æ–¥</span><input type="number" data-mins="1440" class="bag-input"></div>
                <div class="bag-item gold"><span>3 –¥–Ω</span><input type="number" data-mins="4320" class="bag-input"></div>
                <div class="bag-item gold"><span>7 –¥–Ω</span><input type="number" data-mins="10080" class="bag-input"></div>
                <div class="bag-item gold"><span>30 –¥–Ω</span><input type="number" data-mins="43200" class="bag-input"></div>
            </div>
            <div class="actions-group">
                <button class="main-action-btn" onclick="calculateSpeedTime()">–†–ê–•–£–í–ê–¢–ò</button>
                <button class="reset-icon-btn" onclick="resetBag()">üóëÔ∏è</button>
            </div>
        </div>
    </div>

    <div id="calc-old" class="calc-content" style="display: none;">
        <div class="game-panel">
            <h3 class="panel-head">–î–Ω—ñ ‚ûù –ê—Ä–º—ñ—è (–¢1-–¢4)</h3>
            <div class="grid-inputs three">
                <div class="input-wrap"><label>–î–Ω—ñ–≤</label><input type="number" id="main-days" class="arena-input" placeholder="30"></div>
                <div class="input-wrap"><label>–®–≤–∏–¥–∫—ñ—Å—Ç—å %</label><input type="number" id="main-speed" class="arena-input" placeholder="350"></div>
                <div class="input-wrap"><label>–°—É–±—Å–∏–¥—ñ—è %</label><input type="number" id="main-subsidy" class="arena-input" placeholder="0"></div>
            </div>
            
            <div class="control-section">
                <label>–†—ñ–≤–µ–Ω—å</label>
                <div class="tier-grid" id="tier-group-old">
                    <button class="tier-select" data-tier="T1" data-time="15" data-cost="50,50,50,50,0" onclick="selectTier(this, 'old')">T1</button>
                    <button class="tier-select" data-tier="T2" data-time="30" data-cost="100,100,100,100,0" onclick="selectTier(this, 'old')">T2</button>
                    <button class="tier-select" data-tier="T3" data-time="60" data-cost="250,250,250,250,10" onclick="selectTier(this, 'old')">T3</button>
                    <button class="tier-select active" data-tier="T4" data-time="120" data-cost="1000,1000,1000,1000,500" onclick="selectTier(this, 'old')">T4</button>
                </div>
            </div>
            
            <div class="control-section">
                <label>–¢–∏–ø –≤—ñ–π—Å—å–∫</label>
                <div class="tier-grid" id="type-group">
                    <button class="tier-select active" onclick="selectType(this)">–ü—ñ—Ö–∏</button>
                    <button class="tier-select" onclick="selectType(this)">–õ—É–∫–∏</button>
                    <button class="tier-select" onclick="selectType(this)">–ö–æ–Ω—ñ</button>
                    <button class="tier-select" onclick="selectType(this)">–û—Å–∞–¥–∞</button>
                </div>
            </div>

            <div class="big-result">
                <span>–í–∏–π–¥–µ –≤—ñ–π—Å—å–∫:</span>
                <div id="res-units" class="highlight">0</div>
            </div>

            <div class="rss-table" id="res-rss-block" style="display:none;">
                <div class="rss-row"><span>üåæ –á–∂–∞</span> <b id="res-food">0</b></div>
                <div class="rss-row"><span>ü™® –ö–∞–º—ñ–Ω—å</span> <b id="res-stone">0</b></div>
                <div class="rss-row"><span>ü™µ –î–µ—Ä–µ–≤–æ</span> <b id="res-wood">0</b></div>
                <div class="rss-row"><span>üíé –†—É–¥–∞</span> <b id="res-ore">0</b></div>
                <div class="rss-row gold"><span>üí∞ –ó–æ–ª–æ—Ç–æ</span> <b id="res-gold">0</b></div>
            </div>

            <div class="actions-group">
                <button class="main-action-btn" onclick="calculateLeft()">–†–û–ó–†–ê–•–£–í–ê–¢–ò</button>
                <button class="reset-icon-btn" onclick="resetCalc('main')">üóëÔ∏è</button>
            </div>
        </div>
    </div>
</div>

<script>
    function handleWeekSwitch(btn, isLastWeek) {
        const parent = btn.parentElement;
        const buttons = parent.querySelectorAll('.week-btn');
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (typeof loadMonsterStats === 'function') loadMonsterStats(isLastWeek);
    }
    
    // –í–±—É–¥–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ –º–∏—Ç—Ç—î–≤–æ
    function switchCalcTab(tabId, btn) {
        document.querySelectorAll('.calc-content').forEach(el => el.style.display = 'none');
        document.getElementById('calc-' + tabId).style.display = 'block';
        const parent = btn.parentElement;
        parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
    function toggleT5SubMode(mode, btn) {
        document.querySelectorAll('.t5-sub-content').forEach(el => el.style.display = 'none');
        document.getElementById('t5-sub-' + mode).style.display = 'block';
        const parent = btn.parentElement;
        parent.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
    function selectTier(btn, type) {
        const parent = btn.parentElement;
        parent.querySelectorAll('.tier-select').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
    function selectType(btn) {
        const parent = btn.parentElement;
        parent.querySelectorAll('.tier-select').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
</script>