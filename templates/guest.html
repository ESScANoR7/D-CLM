<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&V Guild - –ì—ñ—Å—Ç—å</title>
    <link rel="stylesheet" href="/static/css/css.css">
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&display=swap" rel="stylesheet">
</head>
<body class="guest-page-body">
    
    <div class="guest-auth-container">
        <a href="/" class="guest-close-btn">‚úñ</a>

        <div class="guest-frame">
            <header class="guest-header">
                <div class="guest-logo-icon">üìú</div>
                <h1 class="guest-title" id="guest-title">–†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø –ì–û–°–¢–Ø</h1>
                <p class="guest-subtitle">–£–≤—ñ–π–¥—ñ—Ç—å –¥–æ –∞—Ä—Ö—ñ–≤—É –≥—ñ–ª—å–¥—ñ—ó</p>
            </header>

            <div id="guest-auth-error" class="error-message"></div>

            <form class="guest-form" id="guestAuthForm" action="/register_guest" method="POST">
                <div class="guest-input-group">
                    <label>–í–∞—à–µ –Ü–º'—è (–ù—ñ–∫–Ω–µ–π–º)</label>
                    <div class="input-scroll">
                        <span class="rune left">·ö±</span>
                        <input type="text" name="nickname" class="guest-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫" required autocomplete="off">
                        <span class="rune right">·ö®</span>
                    </div>
                </div>

                <div class="guest-input-group">
                    <label>–¢–∞—î–º–Ω–∏–π –ö–æ–¥ (–ü–∞—Ä–æ–ª—å)</label>
                    <div class="input-scroll">
                        <span class="rune left">·ö¶</span>
                        <input type="password" name="password" class="guest-input" placeholder="********" required>
                        <span class="rune right">·õü</span>
                    </div>
                </div>

                <div class="guest-button-wrapper">
                    <button type="submit" class="guest-submit-btn main-btn">
                        <span id="btn-label">–ó–ê–†–ï–Ñ–°–¢–†–£–í–ê–¢–ò–°–¨</span>
                    </button>
                </div>
            </form>

            <div class="guest-switch-container">
                <p class="switch-text">–í–∂–µ –º–∞—î—Ç–µ –∑–∞–ø–∏—Å?</p>
                <button type="button" class="guest-submit-btn alt-btn" id="guest-switch-btn" onclick="switchGuestMode(true)">
                    <span id="switch-btn-label">–£–í–Ü–ô–¢–ò –Ø–ö –ì–Ü–°–¢–¨</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 1. –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤ (–í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è)
function switchGuestMode(isLogin) {
    const form = document.getElementById('guestAuthForm');
    const title = document.getElementById('guest-title');
    const mainBtnLabel = document.getElementById('btn-label');
    const switchBtn = document.getElementById('guest-switch-btn');
    const switchBtnLabel = document.getElementById('switch-btn-label');
    const errorBox = document.getElementById('guest-auth-error');
    const switchText = document.querySelector('.switch-text');

    errorBox.style.display = 'none';
    errorBox.innerText = '';

    if (isLogin) {
        form.action = "/login";
        title.innerText = "–í–•–Ü–î –î–õ–Ø –ì–û–°–¢–ï–ô";
        mainBtnLabel.innerText = "–£–í–Ü–ô–¢–ò";
        switchText.innerText = "–ù–æ–≤–∏–π –≥—ñ—Å—Ç—å?";
        switchBtnLabel.innerText = "–ó–ê–†–ï–Ñ–°–¢–†–£–í–ê–¢–ò–°–¨";
        switchBtn.setAttribute('onclick', 'switchGuestMode(false)');
    } else {
        form.action = "/register_guest";
        title.innerText = "–†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø –ì–û–°–¢–Ø";
        mainBtnLabel.innerText = "–ó–ê–†–ï–Ñ–°–¢–†–£–í–ê–¢–ò–°–¨";
        switchText.innerText = "–í–∂–µ –º–∞—î—Ç–µ –∑–∞–ø–∏—Å?";
        switchBtnLabel.innerText = "–£–í–Ü–ô–¢–ò –Ø–ö –ì–Ü–°–¢–¨";
        switchBtn.setAttribute('onclick', 'switchGuestMode(true)');
    }
}

// 2. –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º–∏ (–í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ JSON-—Ä–µ–¥–∏—Ä–µ–∫—Ç—É)
document.getElementById('guestAuthForm').onsubmit = async function(e) {
    e.preventDefault(); // –ó–∞–≤–∂–¥–∏ –∑—É–ø–∏–Ω—è—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –≤—ñ–¥–ø—Ä–∞–≤–∫—É
    
    const errorBox = document.getElementById('guest-auth-error');
    errorBox.style.display = 'none';
    
    const submitBtn = document.getElementById('guest-main-btn');
    if (submitBtn) submitBtn.disabled = true;

    try {
        const formData = new FormData(this);
        const response = await fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest' // –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ —Å–µ—Ä–≤–µ—Ä—É, —â–æ —Ü–µ AJAX
            }
        });

        const data = await response.json();

        if (response.ok) {
            // –í–∏–∫–æ–Ω—É—î–º–æ —Ä–µ–¥—ñ—Ä–µ–∫—Ç, —è–∫–∏–π –ø—Ä–∏—Å–ª–∞–≤ —Å–µ—Ä–≤–µ—Ä (dashboard)
            window.location.href = data.redirect || '/dashboard';
        } else {
            // –í–∏–≤–æ–¥–∏–º–æ –ø–æ–º–∏–ª–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ "–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å")
            errorBox.innerText = data.error || "–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É";
            errorBox.style.display = 'block';
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        errorBox.innerText = "–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è.";
        errorBox.style.display = 'block';
    } finally {
        if (submitBtn) submitBtn.disabled = false;
    }
};
    </script>
</body>
</html>